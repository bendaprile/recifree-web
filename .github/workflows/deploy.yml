# GitHub Actions workflow to deploy Recifree to Firebase Hosting
# 
# This workflow automatically builds and deploys the website when:
# - Code is pushed to the main branch
# - Manually triggered via workflow_dispatch
#
# SETUP INSTRUCTIONS:
# 1. Create a Firebase project at https://console.firebase.google.com
# 2. Install Firebase CLI: npm install -g firebase-tools
# 3. Login to Firebase: firebase login
# 4. Initialize hosting: firebase init hosting (select your project)
# 5. Generate a service account key:
#    - Go to Firebase Console > Project Settings > Service Accounts
#    - Click "Generate new private key"
#    - Copy the entire JSON content
# 6. Add the secret to GitHub:
#    - Go to your repo > Settings > Secrets and variables > Actions
#    - Create a new secret named FIREBASE_SERVICE_ACCOUNT
#    - Paste the entire JSON key as the value
# 7. Update .firebaserc with your project ID

name: Deploy to Firebase Hosting

on:
  # Deploy on push to main branch
  push:
    branches:
      - main
  
  # Allow manual trigger from GitHub Actions UI
  workflow_dispatch:

jobs:
  build_and_deploy:
    name: Build and Deploy
    runs-on: ubuntu-latest
    
    steps:
      # Step 1: Checkout the repository
      - name: Checkout code
        uses: actions/checkout@v4
      
      # Step 2: Setup Node.js environment
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'
      
      # Step 3: Install dependencies
      - name: Install dependencies
        run: npm ci
      
      # Step 4: Build the production bundle
      - name: Build project
        run: npm run build
      
      # Step 5: Deploy to Firebase Hosting
      - name: Deploy to Firebase
        uses: FirebaseExtended/action-hosting-deploy@v0
        with:
          repoToken: '${{ secrets.GITHUB_TOKEN }}'
          firebaseServiceAccount: '${{ secrets.FIREBASE_SERVICE_ACCOUNT }}'
          channelId: live
          projectId: recifree-web-4731f
        env:
          FIREBASE_CLI_EXPERIMENTS: webframeworks
